<!DOCTYPE html>
<html lang='zh_CN'>
<head>
<meta charset='UTF-8'>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
<title>Pixiv工具箱</title>
<link rel="stylesheet" href="https://cdn.bootcss.com/mdui/0.4.3/css/mdui.min.css">
<script src="https://cdn.bootcss.com/mdui/0.4.3/js/mdui.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/mdui/0.4.3/js/mdui.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>-->
</head>
<body class="mdui-theme-primary-pink mdui-theme-accent-blue mdui-appbar-with-toolbar">
<div class="mdui-appbar mdui-appbar-scroll-hide mdui-appbar-fixed">
  <div class="mdui-toolbar mdui-color-theme-300">
  	    <a class="mdui-btn mdui-btn-icon mdui-text-color-white mdui-hidden-sm-up menu"><i class="mdui-icon material-icons">menu</i></a>
    <a class="mdui-typo-title mdui-text-color-white">Pixiv工具箱</a>
    <div class="mdui-toolbar-spacer"></div>
    <select class="mdui-select mdui-text-color-white" id="lb">
  <option value="1">搜索关键字</option>
  <option value="0">排行榜</option>
  <option value="2">作品id</option>
</select>
  </div>
</div>
<p>
<div class="mdui-container">
<div class="mdui-row">
<div class="mdui-col-xs-12 mdui-col-sm-5">

<div class="mdui-shadow-4 cat mdui-p-x-1">
<div class="mdui-textfield mdui-float-left mdui-m-r-1">
  <label class="mdui-textfield-label">指定榜单</label>
<select class="mdui-select" id="cat">
  <option value="day">日榜</option>
  <option value="week" selected>周榜</option>
  <option value="month">月榜</option>
    <option value="male">男性向-日榜</option>
      <option value="female">女性向-日榜</option>
</select>
</div>

<div class="mdui-textfield">
  <label class="mdui-textfield-label">日期</label>
  <input class="mdui-textfield-input" id="date" type="text" readonly/>
</div>

<label class="mdui-slider">
  <input class="date-slider" type="range" step="1" min="1" max="58" value="58"/>
</label>

</div>

<div class="mdui-shadow-4 cat mdui-p-x-1">
<div class="mdui-textfield">
  <label class="mdui-textfield-label">指定关键字</label>
  <input class="mdui-textfield-input" type="text" id="keywords"/>
</div>

<div class="mdui-list result mdui-list-dense mdui-row">
  正在获取热门关键词...
</div>
</div>

<div class="mdui-shadow-4 cat mdui-p-x-1">
<div class="mdui-textfield">
  <label class="mdui-textfield-label">指定id</label>
  <input class="mdui-textfield-input" type="number"/>
</div>
</div>

<div class="mdui-hidden-xs mdui-shadow-4 mdui-p-a-1 mdui-m-y-1">
<div class="setting">
<div class="mdui-dialog-content">
<ul class="mdui-list mdui-list-dense">
<li class="mdui-subheader">R-18相关</li>
<label class="mdui-list-item mdui-ripple">
<div class="mdui-checkbox mdui-text-right">
<input type="checkbox" id="r18"/>
<i class="mdui-checkbox-icon"></i>
R-18功能
</div>
</label>
  
<li class="mdui-subheader">预览图片质量</li>
<form class="set-quality">
<label class="mdui-list-item mdui-ripple">
<div class="mdui-radio mdui-text-right">
<input type="radio" name="g" class="ggg" checked/>
<i class="mdui-radio-icon"></i>
较低
</div>
</label>
	
<label class="mdui-list-item mdui-ripple">
<div class="mdui-radio mdui-text-right">
<input type="radio" name="g" class="ggg" />
<i class="mdui-radio-icon"></i>
中
</div>
</label>

<label class="mdui-list-item mdui-ripple">
<div class="mdui-radio">
<input type="radio" name="g" class="ggg"/>
<i class="mdui-radio-icon"></i>
高
</div>
</label>

<label class="mdui-list-item mdui-ripple">
<div class="mdui-radio">
<input type="radio" name="g" class="ggg"/>
<i class="mdui-radio-icon"></i>
原图
</div>
</label>
</form>

<li class="mdui-subheader">加载图片引擎</li>
<form class="set-tool">

<label class="mdui-list-item mdui-ripple">
<div class="mdui-radio">
<input type="radio" name="g" class="gg" checked/>
<i class="mdui-radio-icon"></i>
pixiv.cat
</div>
</label>

<label class="mdui-list-item mdui-ripple">
<div class="mdui-radio">
<input type="radio" name="g" class="gg"/>
<i class="mdui-radio-icon"></i>
moe123.net
</div>
</label>

</form>

<li class="mdui-subheader">杂项</li>
<li class="mdui-list-item mdui-ripple lamp">
    <i class="mdui-list-item-icon mdui-icon material-icons">brightness_4</i>
    <div class="mdui-list-item-content">开/关灯</div>
  </li>

<li class="mdui-list-item mdui-ripple">
    <i class="mdui-list-item-icon mdui-icon material-icons">info</i>
    <div class="mdui-list-item-content">关于</div>
  </li>

</ul>
</div>
</div>
</div>

</div>

<div class="mdui-col-xs-12 mdui-col-sm-7">
<div class="mdui-row" id="pics">

</div>
</div>

</div>
</div>

<button mdui-headroom="{pinnedClass:'null',unpinnedClass:'mdui-fab-hide'}" class="mdui-fab mdui-fab-fixed mdui-ripple mdui-color-theme-accent"><i class="mdui-icon material-icons" id="search">search</i></button>

<div id="viewer" class="mdui-dialog">
<div class="mdui-dialog-content mdui-row">
<div style="height:100vh">
<ul id="mess" class="mdui-list mdui-list-dense mdui-col-sm-6">
信息
</ul>
<div id="pictures" class="mdui-row mdui-col-sm-6">

</div>
</div>
</div>
</div>

<div id="gggeet" class="mdui-dialog">

</div>

</body>
<script>

$(".lamp").click(function(){
$("body").toggleClass("mdui-theme-layout-dark")
})
	
var settt=new mdui.Dialog("#gggeet");
$(".menu").click(function(){
$(".setting").children().prependTo("#gggeet")
settt.open()
settt.handleUpdate()
})

$("#gggeet").on("close.mdui.dialog",function(){
$("#gggeet").children().prependTo(".setting")
})
	
var Page=1
var quality=0
var picUrlMaster=0
$("#search").click(function(){
Page=1
$("#pics").empty()
searchAll()
})

$("#r18").click(function(){
settt.close()
/*
if($(this).is(":checked")){
$("#r18").prop("checked",false)
mdui.confirm('你是萝莉控吗？<br>你是人妻控吗？<br>局子茶水已经好了', '警告！',
  function(){
$("body").toggleClass("mdui-theme-accent-blue")
$("body").toggleClass("mdui-theme-accent-deep-orange")
$("#r18").prop("checked",true)
$("body").addClass("mdui-theme-layout-dark")
  },
  function(){
  },{
confirmText:'是的',
cancelText:'按错了'
})
}
else{
$("body").toggleClass("mdui-theme-accent-blue")
$("body").toggleClass("mdui-theme-accent-deep-orange")
$("body").removeClass("mdui-theme-layout-dark")
}*/
alert("不可用")
})

function searchAll(){
var mode=$("#lb").val()
if(mode==0){
var date=$("#date").val()
var cat=$("#cat").val()
var searchUrl="https://api.pixivic.com/ranks?date="+date+"&page="+Page+"&mode="+cat
searching(searchUrl,mode)
}
if(mode==1){
var Key=$("#keywords").val()
if(Key!=""){
var R_18=$("#r18").is(":checked")
var r_18="0"
if(R_18){
r_18="1"
}
var searchUrl="https://api.pixivic.com/illustrations?xRestrict="+r_18+"&keyword="+Key+"&page="+Page
searching(searchUrl,mode)
}
}
if(mode==2){
alert("ID搜索功能咕咕咕")
}
}

function searching(url,mode){
var R_18=$("#r18").is(":checked")
var r_18="0"
if(R_18){
r_18="1"
}
$.getJSON(url,function(dat){
if(mode==1){
var dataa=dat.data
}
if(mode==0){
var dataa=dat.data
}
for(var i in dataa){

var info=dataa[i]
var id=info.id
var title=info.title
var tag=info.tags
var artist=info.artistPreView.name
var avatar=pixToIMG(info.artistPreView.avatar)
var view=info.totalView
var star=info.totalBookmarks
var date=info.createDate
var count=info.pageCount
var caption=info.caption
var graph=info.imageUrls
var xrestrict=info.xrestrict
var tags=new Array()
var graphs=new Array()
var head=pixToIMG(graph[0].squareMedium)

for(var j in graph){
graphs.push(pixToIMG(graph[j].squareMedium)+"卍※"+pixToIMG(graph[j].medium)+"卍※"+pixToIMG(graph[j].large)+"卍※"+pixToIMG(graph[j].original))
}

for(var k in tag){
tags.push(tag[k].name)
}

tags=tags.join("↹")
graphs=graphs.join("↹")
var total=new Array()
total.push(graphs)
total.push(title)
total.push(id)
total.push(artist)
total.push(avatar)
total.push(view)
total.push(star)
total.push(date)
total.push(caption)
total.push(tags)

if(xrestrict==r_18){
$("#pics").append("<div class='mdui-card mdui-col-xs-6 mdui-m-y-1'><div class='information mdui-hidden'>"+total.join("◈")+"</div><div class='mdui-card-media'><img data-original='"+head+"' src='http://code.ciaoca.com/jquery/lazyload/demo/img/grey.gif'/><div class='mdui-card-menu'><button class='mdui-btn mdui-btn-dense mdui-btn-icon mdui-text-color-white mdui-color-theme-accent more'>"+count+"</button><div class='information mdui-hidden'>"+total.join("◈")+"</div></div><div class='mdui-card-media-covered'><div class='mdui-card-primary'><a class='mdui-card-primary-subtitle mdui-text-truncate'>"+title+"</a></div></div></div></div>")
}
}
Page++
if(dataa.length!=0){
$("#pics").append("<div nextEvent='"+url+"' class='mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent nextPage-K mdui-col-xs-12 mdui-m-y-2'>点击加载下一页</div>")
$(".nextPage-K").click(function(){
$(this).detach()
searchAll()
})
}
onMoreEvent()
$('img').lazyload()
})
}

function onMoreEvent(){
var ins=new mdui.Dialog("#viewer");
$("button.more").click(function(){
var method=$(this).next().text()
method=method.split("◈")

$("#mess").empty().append("<li class='mdui-list-item mdui-ripple'><div class='mdui-list-item-content'>"+method[1]+" (id:"+method[2]+")</div></li><li class='mdui-list-item mdui-ripple'><div class='mdui-list-item-avatar'><img src='"+method[4]+"'/></div><div class='mdui-list-item-content'>"+method[3]+"</div></li>  <li class='mdui-list-item mdui-ripple'><i class='mdui-list-item-icon mdui-icon material-icons'>date_range</i><div class='mdui-list-item-content'>"+method[7]+"</div></li><li class='mdui-list-item mdui-ripple'><i class='mdui-list-item-icon mdui-icon material-icons'>visibility</i><div class='mdui-list-item-content'>"+method[5]+"</div></li><li class='mdui-list-item mdui-ripple'><i class='mdui-list-item-icon mdui-icon material-icons'>favorite</i><div class='mdui-list-item-content'>"+method[6]+"</div></li><div class='mdui-typo'><blockquote><p>"+method[8]+"</p></blockquote></div><div id='tag-list' style='overflow-x:auto'></div>")

var tags_list=method[9].split("↹")
for(var m in tags_list){
$("#tag-list").append("<div class='mdui-chip mdui-m-x-1'><span class='mdui-chip-title'>"+tags_list[m]+"</span></div>")
}

ins.open()
ins.handleUpdate()

$("#pictures").empty()
var piccc=method[0].split("↹")
for(var i in piccc){
var image=piccc[i].split("卍※")[quality]
$("#pictures").append("<div class='mdui-card mdui-col-xs-12 mdui-m-y-1 mdui-ripple'><div class='mdui-card-media'><img data-original='"+image+"' class='clicked' src='http://code.ciaoca.com/jquery/lazyload/demo/img/grey.gif'/><div class='mdui-card-menu'><a href='"+image+"' target='_blank' class='mdui-btn mdui-btn-dense mdui-btn-icon mdui-text-color-white mdui-color-theme-accent'><i class='mdui-icon material-icons'>visibility</i></a><a href='"+image+"' download target='_blank' class='mdui-btn mdui-btn-dense mdui-btn-icon mdui-text-color-white mdui-color-theme-accent'><i class='mdui-icon material-icons'>cloud_download</i></a></div></div></div>")
ins.handleUpdate()
}
$('img.clicked').lazyload({
container:$("#viewer").children()
})
ins.handleUpdate()
})
}

function pixToIMG(url){
var toolUrl=["","","https://bigimg.cheerfun.dev/get/"]
if(picUrlMaster>1){
return toolUrl[picUrlMaster]+url
}
else{
var proxyUrl=url.replace("pximg.net","pixiv.cat")
if(picUrlMaster==1){
proxyUrl=url.replace("https://i.pximg.net","https://www.moe123.net/api/imageproxy")
}
return proxyUrl
}
}
	
$.getJSON("https://api.imjad.cn/pixiv/v2/?type=tags",function(data){
$(".result").empty()
var data=data.trend_tags
for(var i in data){
$(".result").append("<li class='mdui-list-item mdui-ripple tags mdui-col-xs-6'>"+data[i].tag+"</li>")
}
$(".tags").click(function(){
$("#keywords").val($(this).text())
setTimeout("$('.result').hide()",200)
$("#search").click()
})
})
	
$("#lb").change(function(){
$(".cat").hide()
$(".cat:eq("+$(this).prop('value')+")").show()
}).change()

$("#keywords").focusin(function(){
$(".result").show()
}).focusout(function(){
setTimeout("$('.result').hide()",200)
})

$(".date-slider").change(function(){
$("#date").val(getNextDate(-(60-Number($(this).val()))))
})
$("#date").val(getNextDate(-2))

$("input:radio").click(function(){
var mod=$(this).parent().parent().parent().attr("class")
if(mod=="set-quality"){
var mod=$("input:radio").filter(".ggg").index($(this))
quality=mod-1+1
}
if(mod=="set-tool"){
var mod=$("input:radio").filter(".gg").index($(this))
picUrlMaster=mod-1+1
}
})

function getNextDate(day){ 
  var dd =new Date();
  dd.setDate(dd.getDate()+day);
  var y = dd.getFullYear();
  var m = dd.getMonth() + 1 < 10 ? "0" + (dd.getMonth() + 1) : dd.getMonth() + 1;
  var d = dd.getDate() < 10 ? "0" + dd.getDate() : dd.getDate();
  return y + "-" + m + "-" + d;
};
</script>
</html>